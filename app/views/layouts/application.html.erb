<%  require 'open-uri' %>

<%$pageUrl=home1_path%> 
<!DOCTYPE html>
<html>
  <head>
    <title>RorPfe</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
    </head>
  <style>
 a:hover
  {
    background-color: 	#a20067;
    box-sizing: border-box;
    color:white;
    vertical-align: middle;
    height: 40px;
    display: inline-block;
    text-decoration:none;
  }
   .button
  {
      border-top-left-radius: 30px;
    border-top-right-radius: 30px;
    border-bottom-right-radius: 30px;
    border-bottom-left-radius: 30px;
    -webkit-border-radius: 30px 30px 30px 30px;

  }
  .form 
{
  border-radius:50px 50px;
  width:50%;
}
  .linkForm
  {
  top:3%;	
  width:27%;
  left: 23.5%;
  position: relative;
  display: iniline;
  opacity: 0.7	;
  -webkit-border-radius: 50px;
  -moz-border-radius: 50px;
  border-radius: 50px;
  border-color: gray;
  }
.app
{
position:absolute;
top:18%;
left:30%;

}
.input_new2
{
top : +160px ;

}
body
{
  margin:0;
  padding:0;
}
  </style>
  <body >
    <%$pageUrl=request.original_fullpath 
    condition=!($pageUrl.include? "sign")#Sign in or Sign up page
    condition2=!($pageUrl.include? "home")
    #if user not connected & page == application page , redirect to home page
    if(condition&& current_user.nil?&&condition2)
    $pageUrl=home1_path
      %>
    <script>
    location.href="<%=$pageUrl%>";
    </script>
    <%
    end
    %>
    
    <!--Flash Messages -->
      <% flash.each do |name,message| %>
      <%= content_tag(:div , message , class:"alert alert-info #{name}" ) %>
      <%end%>
    <%
    location=request.original_fullpath
    #condition stands for user connected & page = outer application page
    condition=(!current_user.nil?) &&( location.include? "home" )
    condition0=location.include? "sign" 
    if(condition0)
    $pageUrl=home1_path  
    end  
    #if condition redirect to application page
    if(condition)
    %>
    <script>
      location.href="<%=root_path%>"
      </script>
    
    <%
    elsif(current_user.nil?)
     #else if user isn't connected display the header navbar
      %>
      <ul id=nabar style="" class="nav flex-column flex-sm-row" id="pills-tab" role="tablist">
            <li class="nav-item flex-sm-fill text-sm-center ">
                <a class=" nav-link active button" id="pills-home-tab"
                 href="<%=home1_path%>"  role="tab"
                    aria-selected="true">
                  <font class="NavButton" >
                    Web Scraper</font></a>
            </li>
            <li class="nav-item flex-sm-fill text-sm-center  ">
                <a class="nav-link button" id="pills-profile-tab" href='<%=home2_path%>' role="tab"
                    aria-controls="pills-profile">
                    <font class="NavButton" >
                    Company</font></a>
            </li>
            <li class="nav-item flex-sm-fill text-sm-center ">
                <a class="nav-link button" id="pills-contact-tab" 
                href="<%=home3_path%>" role="tab">
              <font class="NavButton" >
                Tutorial</font></a>
            </li>
            <li class="nav-item flex-sm-fill text-sm-center ">
                <a class="nav-link button" id="pills-contact-tab" href="<%=home4_path%>" role="tab"
                    aria-selected="false">
                      <font class="NavButton" >
                    Contact</font></a>
            </li>
    </ul>
    <!-- Button trigger modal -->

    <button type="button" onclick="location.href='<%=signin_path%>'"  id="login" class="button btn btn-primary" data-toggle="modal" data-target="#exampleModal">
        LOGIN
    </button>
    
    
    
    
    
    
    
    
    
    
    <%
    end
    if ( ! current_user.nil?)
    %>
    
    
    <%="welcome "+current_user[:email]%>
     <%= link_to "LOG OUT", logout_path , method: :delete,
      class: "button btn btn-secondary" , id:"logout" %>
    <%end%>
    
      <div class="siteNav">
        <% 
        @sites=Site.all
        unless(current_user.nil?)
          user_id=current_user[:id]
          @sites.each do |site|
            if(site[:user_id]==user_id)  
            %>
              
                <%= link_to site.nom, site_path(site) %>
                <%= button_to 'Modifier lien', edit_site_path(site), method: 'get'%>
                <%= button_to 'Supprimer lien', site_path(site), method: 'delete',
                data: { confirm: "Voulez vous vraiment Supprimer le lien de #{site[:nom]} ?" } %>
            <br>
            <%end%>
          <% end %>
        <%end%>
      </div>        
    
    <%= yield %>

  </body>
  
  </html>
