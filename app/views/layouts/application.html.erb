<%  require 'open-uri' %>

<%$pageUrl=home1_path%> 
<!DOCTYPE html>
<html>
  <head>
    <title>RorPfe</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>
    </head>
  <style>
 a:hover
  {
    background-color: 	#a20067;
    box-sizing: border-box;
    color:white;
    vertical-align: middle;
    height: 40px;
    display: inline-block;
    text-decoration:none;
  }
   .button
  {
      border-top-left-radius: 30px;
    border-top-right-radius: 30px;
    border-bottom-right-radius: 30px;
    border-bottom-left-radius: 30px;
    -webkit-border-radius: 30px 30px 30px 30px;

  }
  .form 
{
  border-radius:50px 50px;
  width:50%;
}
  .linkForm
  {
  top:3%;	
  width:27%;
  left: 23.5%;
  position: relative;
  display: iniline;
  opacity: 0.7	;
  -webkit-border-radius: 50px;
  -moz-border-radius: 50px;
  border-radius: 50px;
  border-color: gray;
  }
.app
{
position:absolute;
top:18%;
left:30%;

}
.input_new2
{
top : +160px ;

}
body
{
  margin:0;
  padding:0;
}

.popover-btn
{
    width:100%;
}

 .popover-header 
{
    opacity:0.7;
    background-color:black;
    max-width:100%;
    max-height:18%;
    text-align:center;
    color:lightgray;
    position:relative;
    bottom:0px;
    
}

 .popover  
{
max-width:100%;
height:32%;
background-color:lightgray;
opacity:0.9;
position:relative;

}


.Flash 
{
    top: 0;
    position: absolute;
    left: 241px;
    height: 40px;
    text-align: center;
    width: 81.48%;
    opacity: 0.7;
    background-color: black;
}



</style>
  <body >
    <%$pageUrl=request.original_fullpath 
    condition=!($pageUrl.include? "sign")#Sign in or Sign up page
    condition2=!($pageUrl.include? "home")
    #if user not connected & page == application page , redirect to home page
    if(condition&& current_user.nil?&&condition2)
    $pageUrl=home1_path
      %>
    <script>
    location.href="<%=$pageUrl%>";
    </script>
    <%
    end
    %>
    
    <!--Flash Messages -->
      <% flash.each do |name,message| %>
      <%= content_tag(:div , message , class:"alert alert-info #{name} Flash" ) %>
      <%end%>
    <%
    location=request.original_fullpath
    #condition stands for user connected & page = outer application page
    condition=(!current_user.nil?) &&( location.include? "home" )
    condition0=location.include? "sign" 
    if(condition0)
    $pageUrl=home1_path  
    end  
    #if condition redirect to application page
    if(condition)
    %>
    <script>
      location.href="<%=root_path%>"
      </script>
    
    <%
    elsif(current_user.nil?)
     #else if user isn't connected display the header navbar
      %>
      <ul id=nabar style="" class="nav flex-column flex-sm-row" id="pills-tab" role="tablist">
            <li class="nav-item flex-sm-fill text-sm-center ">
                <a class=" nav-link active button" id="pills-home-tab"
                 href="<%=home1_path%>"  role="tab"
                    aria-selected="true">
                  <font class="NavButton" >
                    Web Scraper</font></a>
            </li>
            <li class="nav-item flex-sm-fill text-sm-center  ">
                <a class="nav-link button" id="pills-profile-tab" href='<%=home2_path%>' role="tab"
                    aria-controls="pills-profile">
                    <font class="NavButton" >
                    Company</font></a>
            </li>
            <li class="nav-item flex-sm-fill text-sm-center ">
                <a class="nav-link button" id="pills-contact-tab" 
                href="<%=home3_path%>" role="tab">
              <font class="NavButton" >
                Tutorial</font></a>
            </li>
            <li class="nav-item flex-sm-fill text-sm-center ">
                <a class="nav-link button" id="pills-contact-tab" href="<%=home4_path%>" role="tab"
                    aria-selected="false">
                      <font class="NavButton" >
                    Contact</font></a>
            </li>
    </ul>
    <!-- Button trigger modal -->

    <button type="button" onclick="location.href='<%=signin_path%>'"  id="login" class="button btn btn-primary" data-toggle="modal" data-target="#exampleModal">
        LOGIN
    </button>
    
    
    
    
    
    
    
    
    
    
    <%
    end
    if ( ! current_user.nil?) #if user is connected then display app
    %>
    
    <div id="BGapp">
      <div id="usernav"><font id="usernavtext"><%="welcome "+current_user[:email]%></font>
      </div>
      <%= link_to "LOG OUT", logout_path , method: :delete,
        class: "button btn btn-secondary" , id:"logout" %>
      <div class="d-none"> 
            <div id="header" align='center' style="middle-align:center" >
              <h2 style="position:relative;bottom:15px;left:0%;">
              Actions
              </h2>
            </div>
          </div> 
        <div class="siteNav">
          <% 
          @sites=Site.all
          popover_index=0
          relativePosition=0
          directories="" 

          unless(current_user.nil?)
            user_id=current_user[:id]
            @sites.each do |site|
              if(site[:user_id]==user_id)  
              popover_index+=1
              @site = site 
              @respository=Respository.find(@site.respository_id).label
              #@respository=site.Respository;
              @FolderClass="" 
              distinct = directories.index @respository
              if(@respository!="") # respository!=""
              @FolderClass="InsideFolder"  
              end  
              if(@respository!=""&&distinct==nil)
                
                directories+=@respository
                relativePosition+=22
              %>
              <img  src="<%=request.base_url%>/assets/folder_icon.jpg" class="Respository" width=23 height=16>
              <b><%=@respository%></b>
              <br>
              
              <%
              end  
              %>
              <style>  
               
                #popover-content<%=popover_index%>
                {
                    
                position:relative;
                top:-4px;
                    
                    

                }
                #popover<%=popover_index%>
                {
                
                top:<%=(popover_index-1)*24+3+relativePosition%>px;
                left:200px;
                height:20px;


                }




              </style>  
               <div class="d-none">
                  <div id="popover-content<%=popover_index%>" align=center  >
                          
                    
                  <%= button_to  'Update Link', edit_site_path(site), method: 'get',
                  style:"position:relative;",class:"popover-btn btn btn-secondary"
                  %>
                  
                  
                  
                  
                      
                      
                          <button  id="Scrap<%=popover_index%>"  style="height:20px" type="button" class="popover-btn btn btn-secondary">
                              <font style="position:relative;top:-8px">
                                  Scrap Website 
                                  </font>
                          </button>
                      <br>
                    
                          <button style="height:20px" type="button" class="popover-btn btn btn-secondary">
                              <font style="position:relative;top:-8px">
                                  Modify Respository 
                                  </font>
                          </button>
                          <br>
                                  <button style="height:20px" type="button" class="popover-btn btn btn-secondary">
                                      <font style="position:relative;top:-8px">
                                      Set up Standby
                                      </font>
                                  </button>
                              <br>
                                  <%= button_to 'Delete Link', site_path(site), method: 'delete',
                                  data: { confirm: "Voulez vous vraiment Supprimer le lien de #{site[:nom]} ?" },
                                  class:"popover-btn btn btn-dark"   %>

                                 
                          
                  </div>
              </div>
                                   
                  <%= link_to site.nom, site_path(site) , class:"navlink "+@FolderClass+"" %>
                                                        
                            <button data-placement="right" data-toggle="popover" data-container="body"
                                type="button" data-html="true" style="position:absolute"  id="popover<%=popover_index%>" 
                                class=" btn btn-secondary" 
                                style="height:20px;position:relative;top:0px">
                                    <font style="position:relative;top:-8px">  +  
                                    </font>
                             </button>
                  <br>
              
              <script>
              $("#popover<%=popover_index%>").popover({
                  html: true, 
                  title : $('#header'),
                content: $('#popover-content<%=popover_index%>'),
                      
              });                     

              $(document).on
              ('blur','.popover', 
              function()
              {
                  
              $(this).popover('hide');
                  
                                

              }
              );


              document.getElementById('Scrap<%=popover_index%>').onclick=function()
              {
                      
                
              
              location.href='<%=scrap_path+'?'+site.id.to_s%>';






              }

              </script>    
    <%end%>
          
              <%end%>
            <% end %>
          <%end%>

        </div>        <!-- <- siteNav -->
    </div> <!-- <- BGapp -->
    <%= yield %>

  </body>
  
  </html>
  <%$url=request.original_url%>
