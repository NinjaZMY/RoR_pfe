
<%

url=request.original_fullpath; 
index = url.index '?' 
if(index.nil?)

$site_id=Site.last.id;
else
$site_id=url[index+1, url.length ].to_i
end
site=Site.find($site_id)
url=Site.find($site_id).url


begin
    $e=""#connected
    $content = Nokogiri::HTML(open(url))
    rescue Exception => $e
end     

if ($e!="")
%>
    <script>   
        location.href='<%=root_path%>';
    </script>
<%else

time=Time.now.strftime("%d/%m/%Y %H:%M");


    Fragment.where(site_id:$site_id).update( 
        :length => 1 , :ordre => 1   , :content => $content , :updated_at => time)
    %>


    <%@site=Site.find($site_id)%>
    <%= render file: 'app/views/sites/show', layout: false %>
    <div class="ScrapMethod">
    <form name=Sform  >
    <input type="radio" name="extractionMethod" checked>
    extraction of the whole page 
    <input type="radio" name="extractionMethod" id="Scrap" >
    Extraction of page Scraps  
    <input type=submit value="Validate" class="btn btn-dark button">
    </form>
    </div>

    <script>

    Sform=document.forms.Sform;
    checkbox=Sform.extractionMethod;

    Sform.onsubmit=function()
    {

    Scrap();

    return false;
    }

    function Scrap()
    {
    i=1;
    x="fragment";
    if(checkbox[0].checked)
    {
        
        i=0;
        x="whole page";
        location.href="<%=site_path(site)%>";
    }    
    
    alert("Extraction Method : "+x) ;
    
    

    }



    </script>
<%end%>